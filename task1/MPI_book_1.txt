–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç—Ä–∞–∂–µ–Ω—ã –í–°–ï MPI –∫–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –≤ —Ä–∞–º–∫–∞—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º. –î–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –∏ –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è. 
–° –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ –ø–æ—è—Å–Ω–µ–Ω–∏—è–º–∏

MPI –∫–æ–º–∞–Ω–¥—ã –∏–∑ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è:

1. MPI_Init(&argc, &argv);
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç MPI-—Å—Ä–µ–¥—É.
    –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π MPI-—Ä–∞–Ω—Ç–∞–π–º
    –ü–æ–¥–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∫ –æ—Å—Ç–∞–ª—å–Ω—ã–º MPI-–ø—Ä–æ—Ü–µ—Å—Å–∞–º
    –î–µ–ª–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –í–°–ï –æ—Å—Ç–∞–ª—å–Ω—ã–µ MPI-—Ñ—É–Ω–∫—Ü–∏–∏

üìå –õ—é–±–∞—è MPI-–ø—Ä–æ–≥—Ä–∞–º–º–∞ –æ–±—è–∑–∞–Ω–∞ –≤—ã–∑–≤–∞—Ç—å MPI_Init –ø–µ—Ä–≤–æ–π
(–¥–æ –ª—é–±—ã—Ö MPI_Send, MPI_Comm_size –∏ —Ç.–¥.)

–°–∏–≥–Ω–∞—Ç—É—Ä–∞
int MPI_Init(int *argc, char ***argv);
argc ‚Äî –∞–¥—Ä–µ—Å argc –∏–∑ main
argv ‚Äî –∞–¥—Ä–µ—Å argv –∏–∑ main

–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: MPI_SUCCESS –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
–í—ã–∑–æ–≤ –ª—é–±–æ–π MPI-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ MPI_Init ‚Üí –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ


2. MPI_Comm_size(MPI_COMM_WORLD, &size); –°–æ–æ–±—â–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä–µ.

–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ:
MPI_COMM_WORLD = –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã, –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ mpirun -np 64

–°–∏–≥–Ω–∞—Ç—É—Ä–∞
int MPI_Comm_size(MPI_Comm comm, int *size);
comm ‚Äî –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä. –û–±—ã—á–Ω–æ: MPI_COMM_WORLD ‚Äî –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
size ‚Äî —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ int, –∫—É–¥–∞ –±—É–¥–µ—Ç –∑–∞–ø–∏—Å–∞–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: MPI_SUCCESS


3. MPI_Comm_rank(MPI_COMM_WORLD, &rank); –°–æ–æ–±—â–∞–µ—Ç –Ω–æ–º–µ—Ä (rank) —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä–µ. rank ‚àà [0 .. size-1]
–£ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–≤–æ–π rank

–°–∏–≥–Ω–∞—Ç—É—Ä–∞
int MPI_Comm_rank(MPI_Comm comm, int *rank);
comm ‚Äî –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä (MPI_COMM_WORLD)
rank ‚Äî —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ int, –∫—É–¥–∞ –∑–∞–ø–∏—à–µ—Ç—Å—è –Ω–æ–º–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–∞
–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: MPI_SUCCESS

–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏
–î—É–º–∞—Ç—å, —á—Ç–æ rank —Å–≤—è–∑–∞–Ω —Å CPU/—è–¥—Ä–æ–º (–Ω–µ—Ç)
–ó–∞—á–µ–º –≤ –Ω–∞—à–µ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ
    Rank –Ω—É–∂–µ–Ω –≤–µ–∑–¥–µ:
    –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —É–∑–ª–∞ –≤ 8√ó8:

    y = rank / 8;
    x = rank % 8;

    –ü–æ–Ω—è—Ç—å, –∫–∞–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –º–∞—Å—Å–∏–≤–∞ —Ä–µ–¥—É—Ü–∏—Ä–æ–≤–∞—Ç—å
    A[i] = rank + i;


    –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–æ–π —ç–ª–µ–º–µ–Ω—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ–ª—É—á–∏—Ç—å
    –ø—Ä–æ—Ü–µ—Å—Å rank –ø–æ–ª—É—á–∞–µ—Ç R[rank]

    –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫—Ç–æ root (–æ–±—ã—á–Ω–æ rank 0)



4. MPI_Abort(MPI_COMM_WORLD, 1); –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤ –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä–µ.

–°–∏–≥–Ω–∞—Ç—É—Ä–∞
int MPI_Abort(MPI_Comm comm, int errorcode);
comm ‚Äî –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä, –ø—Ä–æ—Ü–µ—Å—Å—ã –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω—É–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å. –û–±—ã—á–Ω–æ MPI_COMM_WORLD
errorcode ‚Äî –∫–æ–¥ –æ—à–∏–±–∫–∏ (—Ü–µ–ª–æ–µ —á–∏—Å–ª–æ)

–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: –ù–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è (–ø—Ä–æ—Ü–µ—Å—Å—ã —É–±–∏–≤–∞—é—Ç—Å—è)

–ó–∞—á–µ–º –≤ –Ω–∞—à–µ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ. –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º MPI_Abort, –µ—Å–ª–∏:
    –∑–∞–ø—É—â–µ–Ω–æ –Ω–µ 64 –ø—Ä–æ—Ü–µ—Å—Å–∞
    –Ω–∞—Ä—É—à–µ–Ω—ã —É—Å–ª–æ–≤–∏—è, –ø—Ä–∏ –∫–æ—Ç–æ—Ä—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω


5. MPI_Comm grid; MPI_Comm ‚Äî —Ç–∏–ø MPI-–∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä–∞ (–æ–±—ä–µ–∫—Ç ‚Äú–≥—Ä—É–ø–ø—ã –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ + –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ–±—â–µ–Ω–∏—è‚Äù).
grid ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, –≤ –∫–æ—Ç–æ—Ä—É—é –º—ã –ø–æ–ª–æ–∂–∏–º –Ω–æ–≤—ã–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä, –≥–¥–µ –ø—Ä–æ—Ü–µ—Å—Å—ã ‚Äú—É–ø–æ—Ä—è–¥–æ—á–µ–Ω—ã‚Äù –∫–∞–∫ 2D-—Ä–µ—à—ë—Ç–∫–∞.
–ß—Ç–æ–±—ã –ø–æ—Ç–æ–º:
    –ø–æ–ª—É—á–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø—Ä–æ—Ü–µ—Å—Å–∞ (x,y)
    –Ω–∞—Ö–æ–¥–∏—Ç—å —Å–æ—Å–µ–¥–µ–π —Å–ª–µ–≤–∞/—Å–ø—Ä–∞–≤–∞/–≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑
    –¥–µ–ª–∞—Ç—å Send/Recv –ø–æ —Ä–µ—à—ë—Ç–∫–µ, –∞ –Ω–µ ‚Äú–∫–∞–∫ –ø–æ–ø–∞–ª–æ –ø–æ rank‚Äù.

6. MPI_Cart_create(MPI_COMM_WORLD, 2, dims, periods, 0, &grid);
–°–æ–∑–¥–∞—ë—Ç –¥–µ–∫–∞—Ä—Ç–æ–≤ (Cartesian) –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä ‚Äî —Ç–æ –µ—Å—Ç—å MPI –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–æ–ø–æ–ª–æ–≥–∏—é –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∫–∞–∫ —Ä–µ—à—ë—Ç–∫—É –∑–∞–¥–∞–Ω–Ω–æ–π —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏.

–≠—Ç–æ ‚ÄúMPI-—ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç‚Äù —Ç–≤–æ–µ–π —Ç—Ä–∞–Ω—Å–ø—å—é—Ç–µ—Ä–Ω–æ–π –º–∞—Ç—Ä–∏—Ü—ã 8√ó8.

–°–∏–≥–Ω–∞—Ç—É—Ä–∞
int MPI_Cart_create(MPI_Comm old_comm, int ndims, const int dims[], const int periods[], int reorder, MPI_Comm *new_comm);
old_comm ‚Äî –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä, –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –±–µ—Ä—ë–º –ø—Ä–æ—Ü–µ—Å—Å—ã. –£ –Ω–∞—Å: MPI_COMM_WORLD (–≤—Å–µ 64 –ø—Ä–æ—Ü–µ—Å—Å–∞)
ndims ‚Äî —á–∏—Å–ª–æ –∏–∑–º–µ—Ä–µ–Ω–∏–π —Ä–µ—à—ë—Ç–∫–∏. –£ –Ω–∞—Å: 2 (–¥–≤—É–º–µ—Ä–Ω–∞—è —Ä–µ—à—ë—Ç–∫–∞)
dims[] ‚Äî —Ä–∞–∑–º–µ—Ä—ã –ø–æ –∫–∞–∂–¥–æ–º—É –∏–∑–º–µ—Ä–µ–Ω–∏—é. –£ –Ω–∞—Å: dims = {8, 8}. –û–±—ã—á–Ω–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è: dims[0] ‚Äî ‚Äú—Å—Ç—Ä–æ–∫–∏ (y)‚Äù, dims[1] ‚Äî ‚Äú—Å—Ç–æ–ª–±—Ü—ã (x)`.
periods[] ‚Äî ‚Äú–∑–∞–º–∫–Ω—É—Ç–æ—Å—Ç—å‚Äù –ø–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è–º (—Ç–æ—Ä –∏–ª–∏ –Ω–µ—Ç). 0 = –∫—Ä–∞—è –Ω–µ —Å–æ–µ–¥–∏–Ω–µ–Ω—ã, 1 = –∫—Ä–∞—è –∑–∞–º–∫–Ω—É—Ç—ã (–∫–∞–∫ —Ü–∏–ª–∏–Ω–¥—Ä/—Ç–æ—Ä).
–£ –Ω–∞—Å: {0,0} ‚Äî –æ–±—ã—á–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞, –±–µ–∑ wrap-around.
reorder ‚Äî —Ä–∞–∑—Ä–µ—à–∏—Ç—å –ª–∏ MPI –ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏—Ç—å —Ä–∞–Ω–≥–∏ —Ä–∞–¥–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏. 0 = –Ω–µ –ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞—Ç—å, 1 = –º–æ–∂–Ω–æ.
–£ –Ω–∞—Å 0, —á—Ç–æ–±—ã rank-–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –æ–∂–∏–¥–∞–µ–º–æ–π –ª–æ–≥–∏–∫–µ –∏ –±—ã–ª–æ –ø—Ä–æ—â–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å/–æ–±—ä—è—Å–Ω—è—Ç—å.
new_comm ‚Äî –∫—É–¥–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤—ã–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä. –£ –Ω–∞—Å: &grid

–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
–ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –≤–æ—à—ë–ª –≤ –Ω–æ–≤—É—é —Ç–æ–ø–æ–ª–æ–≥–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –º–µ–Ω—å—à–µ, —á–µ–º –Ω—É–∂–Ω–æ), —Ç–æ –µ–º—É –º–æ–≥—É—Ç –≤–µ—Ä–Ω—É—Ç—å MPI_COMM_NULL. 
–í –Ω–∞—à–µ–π –∑–∞–¥–∞—á–µ –º—ã –∑–∞—Ä–∞–Ω–µ–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º size==64, –ø–æ—ç—Ç–æ–º—É —ç—Ç–æ –Ω–µ –¥–æ–ª–∂–Ω–æ —Å–ª—É—á–∏—Ç—å—Å—è.

–ó–∞—á–µ–º –≤ –Ω–∞—à–µ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ
–ú—ã –º–æ–¥–µ–ª–∏—Ä—É–µ–º —Å–µ—Ç—å 8√ó8. MPI_Cart_create –¥–µ–ª–∞–µ—Ç —ç—Ç–æ ‚Äú–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ‚Äù –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–∞–ª—å—à–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —É–¥–æ–±–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ MPI_Cart_coords, MPI_Cart_shift –≤–º–µ—Å—Ç–æ —Ä—É—á–Ω–æ–π –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ –∏ —Ç–∞–±–ª–∏—Ü —Å–æ—Å–µ–¥–µ–π.




7. MPI_Cart_coords(grid, rank, 2, coords) - –ü–æ –Ω–æ–º–µ—Ä—É –ø—Ä–æ—Ü–µ—Å—Å–∞ (rank –≤ grid) –≤—ã–¥–∞—ë—Ç –µ–≥–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Ä–µ—à—ë—Ç–∫–µ.

–°–∏–≥–Ω–∞—Ç—É—Ä–∞
int MPI_Cart_coords(MPI_Comm comm, int rank, int maxdims, int coords[]);
comm ‚Äî –¥–µ–∫–∞—Ä—Ç–æ–≤ –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä (grid)
rank ‚Äî —Ä–∞–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ —ç—Ç–æ–º –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä–µ
maxdims ‚Äî —Å–∫–æ–ª—å–∫–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å (–æ–±—ã—á–Ω–æ ndims)
coords[] ‚Äî –º–∞—Å—Å–∏–≤ –¥–ª–∏–Ω—ã ndims, –∫—É–¥–∞ –∑–∞–ø–∏—à—É—Ç—Å—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –í 2D: coords[0] –∏ coords[1]

–ó–∞—á–µ–º –≤ –Ω–∞—à–µ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ
–ú—ã –ø–æ–ª—É—á–∞–µ–º (y, x) (–∏–ª–∏ (row, col)), —á—Ç–æ–±—ã:
    –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫—Ç–æ –Ω–∞ –∫—Ä–∞—é (–Ω–µ—Ç —Å–æ—Å–µ–¥–∞ —Å–ª–µ–≤–∞/—Å–ø—Ä–∞–≤–∞)
    –ø–æ–Ω–∏–º–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã —Ä–µ–¥—É–∫—Ü–∏–∏ (—Å–¥–≤–∏–≥–∏ –≤–ª–µ–≤–æ/–≤–≤–µ—Ä—Ö)
    —Ä–∞–∑–¥–∞–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ —Å—Ç—Ä–æ–∫–∞–º/—Å—Ç–æ–ª–±—Ü–∞–º.




8. MPI_Cart_shift(grid, 1, 1, &left, &right); –î–∞—ë—Ç —Ä–∞–Ω–≥–∏ —Å–æ—Å–µ–¥–µ–π –≤–¥–æ–ª—å –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è —Ä–µ—à—ë—Ç–∫–∏.
–°–∏–≥–Ω–∞—Ç—É—Ä–∞
int MPI_Cart_shift(MPI_Comm comm, int direction, int disp, int *rank_source, int *rank_dest);
comm ‚Äî –¥–µ–∫–∞—Ä—Ç–æ–≤ –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä (grid)
direction ‚Äî –Ω–æ–º–µ—Ä –∏–∑–º–µ—Ä–µ–Ω–∏—è:
0 ‚Äî –ø–µ—Ä–≤–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ (—É –Ω–∞—Å y, ‚Äú–≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑‚Äù)
1 ‚Äî –≤—Ç–æ—Ä–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ (—É –Ω–∞—Å x, ‚Äú–ª–µ–≤–æ/–ø—Ä–∞–≤–æ‚Äù)

disp ‚Äî —Å–º–µ—â–µ–Ω–∏–µ (–Ω–∞ —Å–∫–æ–ª—å–∫–æ –∫–ª–µ—Ç–æ–∫)
1 = –±–ª–∏–∂–∞–π—à–∏–π —Å–æ—Å–µ–¥. –ú–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å 2, 3, –Ω–æ –≤ —Ç—Ä–∞–Ω—Å–ø—å—é—Ç–µ—Ä–Ω–æ–π –º–∞—Ç—Ä–∏—Ü–µ –æ–±—ã—á–Ω–æ –±–µ—Ä—É—Ç 1.

rank_source ‚Äî ‚Äú–æ—Ç–∫—É–¥–∞ —è –ø–æ–ª—É—á—É, –µ—Å–ª–∏ —Å–¥–≤–∏–≥ –≤ +disp‚Äù (—Å–æ—Å–µ–¥ ‚Äú—Å–∑–∞–¥–∏‚Äù)
rank_dest ‚Äî ‚Äú–∫—É–¥–∞ —è –æ—Ç–ø—Ä–∞–≤–ª—é, –µ—Å–ª–∏ —Å–¥–≤–∏–≥ –≤ +disp‚Äù (—Å–æ—Å–µ–¥ ‚Äú–≤–ø–µ—Ä–µ–¥–∏‚Äù)

‚ö†Ô∏è –ù–∞ –≥—Ä–∞–Ω–∏—Ü–µ –ø—Ä–∏ periods=0 MPI –≤–µ—Ä–Ω—ë—Ç MPI_PROC_NULL –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —Å–æ—Å–µ–¥–∞.
–ò —ç—Ç–æ —É–¥–æ–±–Ω–æ: MPI_Send(..., MPI_PROC_NULL, ...) —Ñ–æ—Ä–º–∞–ª—å–Ω–æ –±–µ–∑–æ–ø–∞—Å–µ–Ω (–æ–ø–µ—Ä–∞—Ü–∏—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è no-op), 
–Ω–æ –≤ —Ç–≤–æ—ë–º –∫–æ–¥–µ –º—ã –æ–±—ã—á–Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ —É—Å–ª–æ–≤–Ω–æ –Ω–µ —à–ª—ë–º/–Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ–º –Ω–∞ –∫—Ä–∞—è—Ö.

–ü–æ—á–µ–º—É —Ç–∞–∫ –ø–æ–¥–ø–∏—Å–∞–ª–∏ –≤ –∫–æ–¥–µ
MPI_Cart_shift(grid, 1, 1, &left, &right);
–ó–¥–µ—Å—å direction=1 ‚Äî –æ—Å—å x. –ü—Ä–∏ disp=1: –æ–¥–∏–Ω –∏–∑ –≤—ã—Ö–æ–¥–æ–≤ –±—É–¥–µ—Ç ‚Äú–ª–µ–≤—ã–π‚Äù —Å–æ—Å–µ–¥, –¥—Ä—É–≥–æ–π ‚Äú–ø—Ä–∞–≤—ã–π‚Äù (–≤ —Ç–µ—Ä–º–∏–Ω–∞—Ö –Ω–∞—à–µ–π –≥–µ–æ–º–µ—Ç—Ä–∏–∏).

MPI_Cart_shift(grid, 0, 1, &up, &down);
–ó–¥–µ—Å—å direction=0 ‚Äî –æ—Å—å y. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø–æ–ª—É—á–∞–µ–º ‚Äú–≤–µ—Ä—Ö/–Ω–∏–∑‚Äù.
–ó–∞—á–µ–º –≤ –Ω–∞—à–µ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ
—Ä–µ–¥—É–∫—Ü–∏—è ‚Äú–ø–æ–ª–∑—ë—Ç‚Äù –≤–ª–µ–≤–æ –ø–æ —Å—Ç—Ä–æ–∫–∞–º (left/right)
–ø–æ—Ç–æ–º –≤–≤–µ—Ä—Ö –ø–æ –ø–µ—Ä–≤–æ–º—É —Å—Ç–æ–ª–±—Ü—É (up/down)

–∑–∞—Ç–µ–º scatter –≤–Ω–∏–∑ –∏ –≤–ø—Ä–∞–≤–æ ‚Äî –æ–ø—è—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ —Å–æ—Å–µ–¥—è–º
–ë–µ–∑ MPI_Cart_shift —Ç–µ–±–µ –ø—Ä–∏—à–ª–æ—Å—å –±—ã –≤—Ä—É—á–Ω—É—é –≤—ã—á–∏—Å–ª—è—Ç—å ‚Äú–∫—Ç–æ –º–æ–π —Å–æ—Å–µ–¥‚Äù —Å –∫—É—á–µ–π –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü—ã.



9. MPI_Send(buf, V, MPI_INT, left, 1000 + y, grid);
–ë–ª–æ–∫–∏—Ä—É—é—â–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è: –ø—Ä–æ—Ü–µ—Å—Å –ø–æ—Å—ã–ª–∞–µ—Ç –º–∞—Å—Å–∏–≤ buf —Å–æ—Å–µ–¥—É left –≤ –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä–µ grid.
‚Äú–ë–ª–æ–∫–∏—Ä—É—é—â–∞—è‚Äù –æ–∑–Ω–∞—á–∞–µ—Ç: –≤—ã–∑–æ–≤ –Ω–µ –≤–µ—Ä–Ω—ë—Ç—Å—è, –ø–æ–∫–∞ MPI –Ω–µ –ø–æ—Å—á–∏—Ç–∞–µ—Ç, —á—Ç–æ –±—É—Ñ–µ—Ä buf –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 
(–¥–µ—Ç–∞–ª–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏/—Ä–∞–∑–º–µ—Ä–∞: –º–æ–∂–µ—Ç –¥–æ–∂–¥–∞—Ç—å—Å—è –ø—Ä–∏—ë–º–∞, –º–æ–∂–µ—Ç –±—É—Ñ–µ—Ä–∏–∑–æ–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–∏ MPI).

–°–∏–≥–Ω–∞—Ç—É—Ä–∞ (C)
int MPI_Send(const void *buf, int count, MPI_Datatype datatype, int dest, int tag, MPI_Comm comm);
buf ‚Äî —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –Ω–∞—á–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö
count ‚Äî —Å–∫–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ç–∏–ø–∞ datatype –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º. –£ –Ω–∞—Å: V (64 —ç–ª–µ–º–µ–Ω—Ç–∞)
datatype ‚Äî —Ç–∏–ø —ç–ª–µ–º–µ–Ω—Ç–∞ –£ –Ω–∞—Å: MPI_INT (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç int)
dest ‚Äî —Ä–∞–Ω–≥ –ø–æ–ª—É—á–∞—Ç–µ–ª—è –≤ –¥–∞–Ω–Ω–æ–º –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä–µ. –£ –Ω–∞—Å: left (—Å–æ—Å–µ–¥ —Å–ª–µ–≤–∞). 
–ï—Å–ª–∏ –Ω–∞ –∫—Ä–∞—é –∏ —Å–æ—Å–µ–¥–∞ –Ω–µ—Ç, MPI –º–æ–∂–µ—Ç –¥–∞—Ç—å MPI_PROC_NULL ‚Äî —Ç–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ ‚Äú–Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å‚Äù.
tag ‚Äî ‚Äú–º–µ—Ç–∫–∞‚Äù —Å–æ–æ–±—â–µ–Ω–∏—è (—Ü–µ–ª–æ–µ —á–∏—Å–ª–æ), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑–ª–∏—á–µ–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π. –£ –Ω–∞—Å: 1000 + y ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏.
comm ‚Äî –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä, –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É—é—Ç—Å—è dest –∏ tag. –£ –Ω–∞—Å: grid
–ü–æ—á–µ–º—É tag –∏–º–µ–Ω–Ω–æ 1000 + y?
–í MPI –º–æ–∂–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏–¥—Ç–∏ –º–Ω–æ–≥–æ —Ä–∞–∑–Ω—ã—Ö –ø–µ—Ä–µ—Å—ã–ª–æ–∫ (—É –Ω–∞—Å –µ—â—ë –µ—Å—Ç—å: —Ä–µ–¥—É–∫—Ü–∏—è –ø–æ —Å—Ç–æ–ª–±—Ü—É (tag 2000), scatter –≤–Ω–∏–∑ (tag 3000), scatter –ø–æ —Å—Ç—Ä–æ–∫–µ (tag 4000+y))

–ï—Å–ª–∏ –±—ã —Ç–µ–≥–∏ –ø–µ—Ä–µ—Å–µ–∫–∞–ª–∏—Å—å, –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –ø—Ä–∏–Ω—è—Ç—å –Ω–µ —Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ (–æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç). –ü–æ—ç—Ç–æ–º—É:
1000+y ‚Äî —Ä–µ–¥—É–∫—Ü–∏—è –≤ —Å—Ç—Ä–æ–∫–µ y (8 –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö ‚Äú–∫–æ–Ω–≤–µ–π–µ—Ä–æ–≤‚Äù –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
–¥—Ä—É–≥–æ–π —ç—Ç–∞–ø ‚Äî –¥—Ä—É–≥–∏–µ —Ç–µ–≥–∏
–≠—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∏ –ø–æ–Ω—è—Ç–Ω–æ–π.



10. MPI_Recv(tmp, V, MPI_INT, right, 1000 + y, grid, &st);
–ë–ª–æ–∫–∏—Ä—É—é—â–∏–π –ø—Ä–∏—ë–º —Å–æ–æ–±—â–µ–Ω–∏—è: –ø—Ä–æ—Ü–µ—Å—Å –∂–¥—ë—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —Å–æ—Å–µ–¥–∞ right —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º tag –≤ –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä–µ grid –∏ –∫–ª–∞–¥—ë—Ç –¥–∞–Ω–Ω—ã–µ –≤ tmp.

int MPI_Recv(void *buf, int count, MPI_Datatype datatype, int source, int tag, MPI_Comm comm, MPI_Status *status);
buf ‚Äî –∫—É–¥–∞ –ø—Ä–∏–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ. –£ –Ω–∞—Å: tmp (–ª–æ–∫–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ int tmp[64])
count, datatype ‚Äî –æ–∂–∏–¥–∞–µ–º —Ä–æ–≤–Ω–æ V —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ç–∏–ø–∞ MPI_INT
source ‚Äî –æ—Ç –∫–æ–≥–æ –∂–¥–∞—Ç—å (—Ä–∞–Ω–≥ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è). –£ –Ω–∞—Å: right (—Å–æ—Å–µ–¥ —Å–ø—Ä–∞–≤–∞). –ï—Å–ª–∏ –ø–æ—Å—Ç–∞–≤–∏—Ç—å MPI_ANY_SOURCE, –º–æ–∂–Ω–æ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ—Ç –ª—é–±–æ–≥–æ, –Ω–æ —ç—Ç–æ —É—Å–ª–æ–∂–Ω–∏—Ç –ª–æ–≥–∏–∫—É.
tag ‚Äî –∫–∞–∫–æ–π tag –∂–¥–∞—Ç—å. –£ –Ω–∞—Å: 1000 + y (—Ç–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Ä–µ–¥—É–∫—Ü–∏–∏ —Å—Ç—Ä–æ–∫–∏ y)
comm ‚Äî grid
status ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∫—É–¥–∞ MPI –∑–∞–ø–∏—à–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–∏—à–µ–¥—à–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ (MPI_SOURCE, MPI_TAG, —Ä–µ–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∏ —Ç.–¥.)

–ó–∞—á–µ–º –≤ –Ω–∞—à–µ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ
–≠—Ç–æ ‚Äú–≤—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞‚Äù —à–∞–≥–∞ —Ä–µ–¥—É–∫—Ü–∏–∏: —É–∑–µ–ª —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ–π x=k-1 –∂–¥—ë—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç x=k (—Å–ø—Ä–∞–≤–∞), —á—Ç–æ–±—ã –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø–æ—ç–ª–µ–º–µ–Ω—Ç–Ω–æ MAX.

–í–∞–∂–Ω–∞—è —Ç–æ–Ω–∫–æ—Å—Ç—å: deadlock –∏ –ø–æ—Ä—è–¥–æ–∫ Send/Recv
–ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ MPI_Send/MPI_Recv –º–æ–≥—É—Ç –ø–æ–≤–∏—Å–Ω—É—Ç—å, –µ—Å–ª–∏ –æ–±–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –¥–µ–ª–∞—é—Ç Send –¥—Ä—É–≥ –¥—Ä—É–≥—É (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π deadlock). –í –Ω–∞—à–µ–º –∫–æ–¥–µ –º—ã –∏–∑–±–µ–∂–∞–ª–∏ —ç—Ç–æ–≥–æ —Ç–µ–º, —á—Ç–æ –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ k:
–ø—Ä–æ—Ü–µ—Å—Å—ã —Å x==k —Ç–æ–ª—å–∫–æ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç
–ø—Ä–æ—Ü–µ—Å—Å—ã —Å x==k-1 —Ç–æ–ª—å–∫–æ –ø—Ä–∏–Ω–∏–º–∞—é—Ç
–æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–ª—á–∞—Ç

–¢–æ –µ—Å—Ç—å –Ω–µ—Ç —Å–∏—Ç—É–∞—Ü–∏–∏ ‚Äú–æ–±–∞ –∂–¥—É—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞‚Äù.


11. MPI_Comm_free(&grid);
–û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä.
–£–¥–∞–ª—è–µ—Ç –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä grid, —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ä–∞–Ω–µ–µ MPI_Cart_create
–û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–∏–º —Ä–µ—Å—É—Ä—Å—ã MPI

int MPI_Comm_free(MPI_Comm *comm);
comm ‚Äî —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å


12. MPI_Finalize();
–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç MPI-—Å—Ä–µ–¥—É.
    –û—Ç–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç MPI-—Ä–∞–Ω—Ç–∞–π–º–∞
    –ó–∞–≤–µ—Ä—à–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–æ—Ç–æ–∫–∏
    –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å–µ MPI-–æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã